{% extends "base.html.twig" %}

{% block title %}Champ de saisie volontairement frustrant{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/frustrant.css') }}">
    <style>
        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a3e 50%, #0f1b3c 100%);
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 100, 0.1) 0%, transparent 50%),
                linear-gradient(rgba(0, 255, 100, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 100, 0.02) 1px, transparent 1px);
            background-size: 100% 100%, 50px 50px, 50px 50px;
            pointer-events: none;
            z-index: 0;
        }
        main {
            position: relative;
            z-index: 1;
        }
    </style>
{% endblock %}

{% block body %}
<div class="frustrant-container">
    <h1>Entrez votre date de naissance (JJMMYYYY) üéÇ</h1>
    <p class="info">Chaque chiffre appara√Ætra apr√®s avoir r√©pondu correctement aux questions.</p>

    <form id="frustrant-form" method="POST">
        <!-- Champ cach√© pour accumuler la date -->
        <input type="hidden" id="date_naissance" name="date_naissance" value="">
        
        <!-- Affichage de la date progressivement -->
        <div class="date-display">
            <span id="date-output">_ _ _ _ _ _ _ _</span>
        </div>

        <!-- Conteneur des questions -->
        <div id="quiz-container">
            <!-- Question 1 - Digit 0 -->
            <div class="question" data-digit="0" style="display: block;">
                <p class="question-title">1Ô∏è‚É£ Quelle alternative libre √† Windows ?</p>
                <div class="answers" id="answers-0">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>

            <!-- Question 2 - Digit 1 -->
            <div class="question" data-digit="1" style="display: none;">
                <p class="question-title">2Ô∏è‚É£ Quel r√©seau social collecte massivement les donn√©es ?</p>
                <div class="answers" id="answers-1">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>

            <!-- Question 3 - Digit 2 -->
            <div class="question" data-digit="2" style="display: none;">
                <p class="question-title">3Ô∏è‚É£ Quel est le symbole international du logiciel libre ?</p>
                <div class="answers" id="answers-2">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>

            <!-- Question 4 - Digit 3 -->
            <div class="question" data-digit="3" style="display: none;">
                <p class="question-title">4Ô∏è‚É£ Combien de principaux GAFAM y a-t-il ?</p>
                <div class="answers" id="answers-3">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>

            <!-- Question 5 - Digit 4 -->
            <div class="question" data-digit="4" style="display: none;">
                <p class="question-title">5Ô∏è‚É£ Qui a invent√© le World Wide Web ?</p>
                <div class="answers" id="answers-4">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>

            <!-- Question 6 - Digit 5 -->
            <div class="question" data-digit="5" style="display: none;">
                <p class="question-title">6Ô∏è‚É£ Quel OS est d√©velopp√© par la Fondation Linux ?</p>
                <div class="answers" id="answers-5">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>

            <!-- Question 7 - Digit 6 -->
            <div class="question" data-digit="6" style="display: none;">
                <p class="question-title">7Ô∏è‚É£ Quel langage est un pilier du web moderne ?</p>
                <div class="answers" id="answers-6">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>

            <!-- Question 8 - Digit 7 -->
            <div class="question" data-digit="7" style="display: none;">
                <p class="question-title">8Ô∏è‚É£ Quel protocole chiffre les donn√©es en transit ?</p>
                <div class="answers" id="answers-7">
                    <!-- Les 80 boutons seront g√©n√©r√©s par JavaScript -->
                </div>
                <div class="digit-input-wrapper" style="display: none;">
                    <p class="digit-prompt">Entrez votre chiffre :</p>
                    <input type="text" class="digit-input" maxlength="1" inputmode="numeric" placeholder="?">
                </div>
            </div>
        </div>

        <!-- Bouton de soumission -->
        <button type="submit" id="submit-btn" class="submit-btn" disabled>
            Valider la date
        </button>
    </form>

    <!-- Message de r√©sultat -->
    {% if result %}
        <div class="result-message {% if submitted %}success{% else %}error{% endif %}">
            {{ result }}
        </div>
    {% endif %}
</div>

<!-- Vid√©o de surprise : remplacerez videos/surprise.mp4 par la v√¥tre dans public/videos/ -->
<!-- Conteneur de la surprise vid√©o : fond flout√© (zoom√©) + vid√©o principale en object-fit:contain -->
<div id="surprise-container" aria-hidden="true">
    <video id="surprise-bg-video" class="surprise-bg" playsinline autoplay muted loop preload="auto" src="{{ asset('videos/surprise.mp4') }}"></video>
    <video id="surprise-video" class="surprise-main" playsinline preload="auto" src="{{ asset('videos/surprise.mp4') }}"></video>
</div>

{# Le consentement sonore a √©t√© supprim√© : le son est activ√© automatiquement par d√©faut #}

{# expose la liste des vid√©os d√©tect√©es par le contr√¥leur pour que le JS choisisse au hasard #}
<script>
    window.surpriseVideos = [
    {% for f in videos %}
        "{{ asset('videos/' ~ f) }}"{% if not loop.last %},{% endif %}
    {% else %}
        "{{ asset('videos/surprise.mp4') }}"
    {% endfor %}
    ];
</script>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {# Use the non-built public script during development so changes are immediate #}
    <script src="/champ_frustrant.js" defer></script>
{% endblock %}
